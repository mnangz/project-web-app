import { Component, OnDestroy, OnInit } from '@angular/core';
import { NbMediaBreakpointsService, NbMenuService, NbSidebarService, NbThemeService } from '@nebular/theme';
import { NbAuthJWTToken, NbAuthService } from '@nebular/auth';

import { LayoutService } from '../../../@core/utils';
import { map, takeUntil } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { CompanyService } from 'app/services/company.service';

@Component({
  selector: 'ngx-header',
  styleUrls: ['./header.component.scss'],
  templateUrl: './header.component.html',
})
export class HeaderComponent implements OnInit, OnDestroy {

  private destroy$: Subject<void> = new Subject<void>();
  userPictureOnly: boolean = false;
  user: any;
  company: any;

  themes = [
    {
      value: 'default',
      name: 'Light',
    },
    {
      value: 'dark',
      name: 'Dark',
    },
    {
      value: 'cosmic',
      name: 'Cosmic',
    },
    {
      value: 'corporate',
      name: 'Corporate',
    },
  ];

  currentTheme = 'default';

  userMenu = [ { title: 'Log out', link: 'auth/logout' } ];

  base64image = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAAB1CAYAAADQm8ZSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKH2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjhjYzk5ZWM5LTA2YTAtMTQ0OS1iZmRkLWZjYzgxOGU5MTRiZCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5MzljN2ZhMC0zMWU4LTQyNDYtYjliMS1mYzRjYTBhNTlmZTAiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0iMTQ4NjdGOEEyNUVGMkNCQzQ0NUE2QzZBODg4NzU0OUMiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcDpDcmVhdGVEYXRlPSIyMDIxLTA0LTI3VDAxOjQ5OjI1KzAyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMS0wNS0wNFQwMjoxMzoyOCswMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMS0wNS0wNFQwMjoxMzoyOCswMjowMCIgdGlmZjpJbWFnZVdpZHRoPSIzNjIiIHRpZmY6SW1hZ2VMZW5ndGg9IjEzOSIgdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPSIyIiB0aWZmOlNhbXBsZXNQZXJQaXhlbD0iMyIgdGlmZjpYUmVzb2x1dGlvbj0iMS8xIiB0aWZmOllSZXNvbHV0aW9uPSIxLzEiIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjEiIGV4aWY6RXhpZlZlcnNpb249IjAyMjEiIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIzNjIiIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSIxMzkiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoxZGQ3M2I5OS01ZGRkLTMxNDctYWU3ZS0wNGUwYzFhODNiZWEiIHN0RXZ0OndoZW49IjIwMjEtMDQtMjdUMDI6NDc6NTErMDI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9qcGVnIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvanBlZyB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmI4YTI4MTk5LWUxZTUtNTk0Ny1iNDJlLTM4MzA4Mzg1NzE3ZCIgc3RFdnQ6d2hlbj0iMjAyMS0wNC0yN1QwMjo0Nzo1MSswMjowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OTM5YzdmYTAtMzFlOC00MjQ2LWI5YjEtZmM0Y2EwYTU5ZmUwIiBzdEV2dDp3aGVuPSIyMDIxLTA1LTA0VDAyOjEzOjI4KzAyOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxZGQ3M2I5OS01ZGRkLTMxNDctYWU3ZS0wNGUwYzFhODNiZWEiIHN0UmVmOmRvY3VtZW50SUQ9IjE0ODY3RjhBMjVFRjJDQkM0NDVBNkM2QTg4ODc1NDlDIiBzdFJlZjpvcmlnaW5hbERvY3VtZW50SUQ9IjE0ODY3RjhBMjVFRjJDQkM0NDVBNkM2QTg4ODc1NDlDIi8+IDx0aWZmOkJpdHNQZXJTYW1wbGU+IDxyZGY6U2VxPiA8cmRmOmxpPjg8L3JkZjpsaT4gPHJkZjpsaT44PC9yZGY6bGk+IDxyZGY6bGk+ODwvcmRmOmxpPiA8L3JkZjpTZXE+IDwvdGlmZjpCaXRzUGVyU2FtcGxlPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgfeXYoAABi7SURBVHic5Z17vF1Fdce/55zcR4BwQxJQ0UAJT1EwEkGIgCCVgrUq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'

  constructor(private sidebarService: NbSidebarService,
              private menuService: NbMenuService,
              private themeService: NbThemeService,
              private layoutService: LayoutService,
              private breakpointService: NbMediaBreakpointsService,
              private authService: NbAuthService,
              private companyService: CompanyService) {

      this.authService.onTokenChange()
      .subscribe((token: NbAuthJWTToken) => {

        if (token.isValid()) {
          this.user = token.getPayload(); // here we receive a payload from the token and assigns it to our `user` variable
        }

      });
  }

  ngOnInit() {
    this.currentTheme = this.themeService.currentTheme;

    const { xl } = this.breakpointService.getBreakpointsMap();
    this.themeService.onMediaQueryChange()
      .pipe(
        map(([, currentBreakpoint]) => currentBreakpoint.width < xl),
        takeUntil(this.destroy$),
      )
      .subscribe((isLessThanXl: boolean) => this.userPictureOnly = isLessThanXl);

    this.themeService.onThemeChange()
      .pipe(
        map(({ name }) => name),
        takeUntil(this.destroy$),
      )
      .subscribe(themeName => this.currentTheme = themeName);

    this.getCompanyInfo();
  }

  async getCompanyInfo() {
    await this.companyService.getCompany()
      .subscribe(res => {
        this.company = res;
      }, err => {
        console.log(err);
      });
  }

  ngOnDestroy() {
    this.destroy$.next();
    this.destroy$.complete();
  }

  changeTheme(themeName: string) {
    this.themeService.changeTheme(themeName);
  }

  toggleSidebar(): boolean {
    this.sidebarService.toggle(true, 'menu-sidebar');
    this.layoutService.changeLayoutSize();

    return false;
  }

  navigateHome() {
    this.menuService.navigateHome();
    return false;
  }
}
